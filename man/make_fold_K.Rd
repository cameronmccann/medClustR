% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/make_fold_K.R
\name{make_fold_K}
\alias{make_fold_K}
\title{make_fold_K}
\usage{
make_fold_K(data_in, Sname, Yname = NULL, cv_folds = 4)
}
\arguments{
\item{data_in}{A data frame containing at least an \code{id} column
(unique row IDs) and the cluster variable specified by \code{Sname}.
Internally, the function adds/overwrites a temporary integer cluster-label
column \code{K}.}

\item{Sname}{Character string giving the name of the cluster variable in \code{data_in}.}

\item{Yname}{Optional character string giving the name of a binary outcome variable
in \code{data_in} used for within-cluster stratification. Use \code{NULL} to disable
stratification.}

\item{cv_folds}{Integer; number of cross-validation folds (default = 4).}
}
\value{
A list of length \code{cv_folds}, where each element is a fold containing:
\itemize{
\item \code{validation_set}: integer vector of \code{data_in$id} values used for validation.
\item \code{training_set}: integer vector of \code{data_in$id} values used for training.
}
Together, the folds cover all rows in \code{data_in}.
}
\description{
Creates cross-validation folds by first splitting each cluster internally
into \code{cv_folds}, then recombining the v-th fold from each cluster to
form global folds. The result is that each validation fold contains
observations from \emph{all} clusters, and each cluster contributes to every fold.

If \code{Yname} is provided and refers to a binary variable, the function
attempts to stratify folds \emph{within each cluster} by the outcome. Within a
cluster, stratification is only performed when both outcome classes are present
and the minority class count is at least \code{cv_folds}.
}
\examples{
library(origami)
set.seed(1)
df <- data.frame(
  id = 1:20,
  cluster = rep(letters[1:4], each = 5),
  y = rbinom(20, 1, 0.5),
  x = rnorm(20)
)

# Cluster-balanced folds without stratification
folds1 <- make_fold_K(df, Sname = "cluster", Yname = NULL, cv_folds = 2)
str(folds1[[1]])

# Attempt within-cluster stratification by a binary outcome
folds2 <- make_fold_K(df, Sname = "cluster", Yname = "y", cv_folds = 2)
str(folds2[[1]])

}
\seealso{
\code{\link[origami]{make_folds}}, \code{\link[origami]{folds_vfold}}
}
